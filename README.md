# MediRecord SIS - Documentation Compl√®te

## üìã Table des Mati√®res

1. [Vue d'ensemble](#vue-densemble)
2. [Architecture](#architecture)
3. [Installation et Configuration](#installation-et-configuration)
4. [Guide d'utilisation](#guide-dutilisation)
5. [API Reference](#api-reference)
6. [Workflows N8N](#workflows-n8n)
7. [D√©ploiement Production](#d√©ploiement-production)
8. [Maintenance et Monitoring](#maintenance-et-monitoring)
9. [D√©pannage](#d√©pannage)
10. [Contribuer](#contribuer)
python -c "from sentence_transformers import SentenceTransformer; SentenceTransformer('sentence-transformers/all-mpnet-base-v2')"


---

## üéØ Vue d'ensemble

MediRecord est un syst√®me d'information sanitaire personnalis√© qui permet aux professionnels de sant√© de g√©rer leurs patients et de fournir un support automatis√© via WhatsApp en utilisant l'intelligence artificielle.

### Fonctionnalit√©s Principales

- **Gestion des Patients** : Cr√©ation, activation et suivi des dossiers patients
- **RAG Conversationnel** : Assistant IA personnalis√© bas√© sur les documents m√©dicaux
- **Messages Diffus√©s** : Envoi de conseils sant√© et informations √† tous les patients
- **Indexation Automatique** : Traitement et indexation automatique des documents m√©dicaux
- **Interface WhatsApp** : Communication naturelle via WhatsApp
- **Analytics** : M√©triques et rapports d√©taill√©s

### Technologies Utilis√©es

- **Backend** : Django 5.2.1 + Django REST Framework
- **Base de donn√©es** : PostgreSQL + Redis
- **IA** : Google Gemini pour le LLM et les embeddings
- **Vector Database** : Pinecone pour le stockage des vecteurs
- **Automation** : N8N pour les workflows
- **Messaging** : Twilio WhatsApp API
- **Frontend** : Next.js 14 + Tailwind CSS
- **Task Queue** : Celery + Redis
- **OCR** : Tesseract + Python

---

## üèóÔ∏è Architecture

### Architecture Globale

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Frontend      ‚îÇ    ‚îÇ   Django API    ‚îÇ    ‚îÇ   N8N Workflows‚îÇ
‚îÇ   (Next.js)     ‚îÇ‚óÑ‚îÄ‚îÄ‚ñ∫‚îÇ   (REST API)    ‚îÇ‚óÑ‚îÄ‚îÄ‚ñ∫‚îÇ   (Automation) ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                               ‚îÇ                        ‚îÇ
                               ‚ñº                        ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   PostgreSQL    ‚îÇ    ‚îÇ   Redis         ‚îÇ    ‚îÇ   Twilio        ‚îÇ
‚îÇ   (Base donn√©es)‚îÇ    ‚îÇ   (Cache/Queue) ‚îÇ    ‚îÇ   (WhatsApp)    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                               ‚îÇ
                               ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Pinecone      ‚îÇ    ‚îÇ   Google Gemini ‚îÇ
‚îÇ   (Vecteurs)    ‚îÇ    ‚îÇ   (LLM/Embed)   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Modules Django

```
mediServe/
‚îú‚îÄ‚îÄ patients/          # Gestion des patients
‚îú‚îÄ‚îÄ documents/         # Upload et traitement des documents
‚îú‚îÄ‚îÄ rag/              # Syst√®me RAG (Retrieval-Augmented Generation)
‚îú‚îÄ‚îÄ messaging/        # Messages diffus√©s
‚îú‚îÄ‚îÄ sessions/         # Sessions WhatsApp
‚îú‚îÄ‚îÄ metrics/          # M√©triques et analytics
‚îî‚îÄ‚îÄ core/            # Utilitaires communs
```

### Flux de Donn√©es

1. **Cr√©ation Patient** : Frontend ‚Üí Django ‚Üí N8N ‚Üí WhatsApp ‚Üí Patient
2. **Activation** : Patient ‚Üí WhatsApp ‚Üí N8N ‚Üí Django
3. **Indexation Document** : Django ‚Üí Celery ‚Üí OCR ‚Üí Gemini ‚Üí Pinecone
4. **Conversation RAG** : WhatsApp ‚Üí N8N ‚Üí Django ‚Üí Gemini + Pinecone ‚Üí WhatsApp
5. **Message Diffus√©** : Frontend ‚Üí Django ‚Üí N8N ‚Üí WhatsApp (tous patients)

---

## üöÄ Installation et Configuration

### Pr√©requis

- Python 3.9+
- Node.js 18+
- PostgreSQL 13+
- Redis 6+
- Docker (optionnel)

### Installation Rapide

```bash
# 1. Cloner le projet
git clone https://github.com/votre-username/medirecord-sis.git
cd medirecord-sis

# 2. Configuration automatique
chmod +x *.sh
make setup

# 3. Configuration des cl√©s API
cp .env.example .env
# √âditez .env avec vos cl√©s

# 4. Installation frontend
make install-frontend

# 5. D√©marrage complet
make start
```

### Configuration Manuelle

#### 1. Backend Django

```bash
# Environnement virtuel
python3 -m venv venv
source venv/bin/activate

# D√©pendances
pip install -r requirements.txt

# Base de donn√©es
python manage.py migrate

# Superutilisateur
python manage.py createsuperuser
```

#### 2. Services Externes

##### Configuration Gemini
```bash
# Obtenir une cl√© API : https://makersuite.google.com/app/apikey
export GEMINI_API_KEY="votre-cl√©-gemini"
```

##### Configuration Pinecone
```bash
# Cr√©er un compte : https://www.pinecone.io/
# Cr√©er un index avec dimension 768 et m√©trique cosine
export PINECONE_API_KEY="votre-cl√©-pinecone"
export PINECONE_INDEX_NAME="medirecord-rag"
```

##### Configuration Twilio
```bash
# Console Twilio : https://console.twilio.com/
export TWILIO_ACCOUNT_SID="votre-sid"
export TWILIO_AUTH_TOKEN="votre-token"
export TWILIO_WHATSAPP_NUMBER="+14155238886"  # Sandbox
```

#### 3. Frontend Next.js

```bash
# Installation d√©pendances
npm install

# Configuration
echo "NEXT_PUBLIC_DJANGO_API_BASE_URL=http://localhost:8000" > .env.local

# D√©marrage
npm run dev
```

---

## üìñ Guide d'utilisation

### Interface M√©decin

#### 1. Cr√©er un Patient

1. Acc√©dez √† `/dashboard/patients/new`
2. Remplissez le formulaire patient
3. Uploadez les documents m√©dicaux (PDF, images)
4. Cliquez sur "Cr√©er le patient"
5. Le patient re√ßoit automatiquement un message WhatsApp d'activation

#### 2. Envoyer un Message Diffus√©

1. Acc√©dez √† `/dashboard/messages`
2. Cliquez sur "Nouveau Message"
3. R√©digez votre message
4. Choisissez les crit√®res de ciblage (optionnel)
5. Envoyez imm√©diatement ou programmez

### Interface Patient (WhatsApp)

#### 1. Activation du Compte

1. Le patient re√ßoit un message avec un lien d'activation
2. Il clique sur le lien qui ouvre WhatsApp
3. Il envoie le message de confirmation demand√©
4. Son compte est activ√© automatiquement

#### 2. Conversations avec l'IA

```
Patient: "Quelle est ma derni√®re ordonnance ?"
IA: "Selon votre dossier m√©dical, votre derni√®re ordonnance 
     du Dr. Martin du 15/11/2024 contient :
     - Lisinopril 10mg, 1 comprim√© par jour
     - Aspirine 75mg, 1 comprim√© par jour
     
     N'h√©sitez pas si vous avez des questions !"
```

### Analytics et M√©triques

Acc√©dez aux m√©triques via `/api/metrics/dashboard/` :

- Temps de r√©ponse moyen
- Taux de succ√®s d'indexation
- Engagement des messages
- Sant√© des services

---

## üîå API Reference

### Patients

#### Cr√©er un Patient
```http
POST /api/patients/
Content-Type: application/json

{
    "first_name": "Jean",
    "last_name": "Dupont",
    "email": "jean@example.com",
    "phone": "+221771234567",
    "date_of_birth": "1980-01-01",
    "gender": "M",
    "address": "123 Rue Test",
    "medical_history": "Hypertension",
    "allergies": "P√©nicilline",
    "current_medications": "Lisinopril"
}
```

#### Confirmer Activation
```http
POST /api/patients/confirm/
Content-Type: application/json

{
    "phone": "+221771234567",
    "valid": true
}
```

#### V√©rifier Statut
```http
POST /api/patients/check-active/
Content-Type: application/json

{
    "phone": "+221771234567"
}
```

### RAG (Retrieval-Augmented Generation)

#### Requ√™te RAG
```http
POST /api/rag/query/
Content-Type: application/json

{
    "patient_phone": "+221771234567",
    "query": "Quelle est ma posologie ?",
    "session_id": "whatsapp_221771234567_20241201"
}
```

### Messages Diffus√©s

#### Cr√©er un Message
```http
POST /api/messaging/broadcast/
Content-Type: application/json

{
    "title": "Conseil nutrition",
    "content": "Mangez 5 fruits et l√©gumes par jour",
    "category": "health_tip",
    "target_all_patients": true
}
```

#### Envoyer Imm√©diatement
```http
POST /api/messaging/broadcast/{id}/send_now/
```

### Documents

#### Upload Document
```http
POST /api/documents/
Content-Type: multipart/form-data

patient_id: 123
file: [fichier PDF ou image]
```

### M√©triques

#### Dashboard M√©triques
```http
GET /api/metrics/dashboard/?hours=24
```

#### Health Check
```http
GET /api/health/
```

---

## ü§ñ Workflows N8N

### 1. Workflow d'Activation Patient

**D√©clencheur** : Webhook `/webhook/confirm-{token}`

**√âtapes** :
1. R√©ception message WhatsApp
2. V√©rification du message de confirmation
3. Appel API Django pour activer le patient
4. Notification au m√©decin

### 2. Workflow RAG Conversationnel

**D√©clencheur** : Webhook `/whatsapp-rag`

**√âtapes** :
1. Extraction donn√©es WhatsApp
2. V√©rification patient actif
3. Appel API RAG Django
4. R√©ponse WhatsApp au patient
5. Log de la conversation

### 3. Workflow Messages Diffus√©s

**D√©clencheur** : Webhook `/broadcast-message`

**√âtapes** :
1. R√©ception donn√©es du message
2. Division par patient cible
3. Envoi WhatsApp avec d√©lai
4. Log du statut de livraison
5. Rapport final

### Configuration des Credentials N8N

1. **Twilio** :
   - User: Account SID
   - Password: Auth Token

2. **Django API** :
   - Utiliser les URLs de base configur√©es

---

## üåê D√©ploiement Production

### 1. Serveur Cloud (Ubuntu 22.04)

#### Installation des D√©pendances
```bash
# Mise √† jour syst√®me
sudo apt update && sudo apt upgrade -y

# Python et outils
sudo apt install -y python3.11 python3.11-venv python3-pip
sudo apt install -y postgresql postgresql-contrib redis-server
sudo apt install -y nginx certbot python3-certbot-nginx
sudo apt install -y tesseract-ocr tesseract-ocr-fra

# Docker pour N8N
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh
sudo usermod -aG docker $USER
```

#### Configuration Base de Donn√©es
```bash
sudo -u postgres createdb medirecord_prod
sudo -u postgres createuser medirecord_user
sudo -u postgres psql -c "ALTER USER medirecord_user WITH PASSWORD 'mot_de_passe_securise';"
sudo -u postgres psql -c "GRANT ALL PRIVILEGES ON DATABASE medirecord_prod TO medirecord_user;"
```

### 2. Configuration Django Production

#### settings_production.py
```python
import os
from .settings import *

DEBUG = False
ALLOWED_HOSTS = ['votre-domaine.com', 'www.votre-domaine.com']

# Base de donn√©es
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.postgresql',
        'NAME': 'medirecord_prod',
        'USER': 'medirecord_user',
        'PASSWORD': os.getenv('DB_PASSWORD'),
        'HOST': 'localhost',
        'PORT': '5432',
    }
}

# S√©curit√©
SECRET_KEY = os.getenv('DJANGO_SECRET_KEY')
SECURE_BROWSER_XSS_FILTER = True
SECURE_CONTENT_TYPE_NOSNIFF = True
X_FRAME_OPTIONS = 'DENY'
SECURE_HSTS_SECONDS = 31536000
SECURE_HSTS_INCLUDE_SUBDOMAINS = True
SECURE_HSTS_PRELOAD = True

# HTTPS
if not DEBUG:
    SECURE_PROXY_SSL_HEADER = ('HTTP_X_FORWARDED_PROTO', 'https')
    SECURE_SSL_REDIRECT = True
    SESSION_COOKIE_SECURE = True
    CSRF_COOKIE_SECURE = True

# Logs
LOGGING = {
    'version': 1,
    'disable_existing_loggers': False,
    'handlers': {
        'file': {
            'level': 'INFO',
            'class': 'logging.handlers.RotatingFileHandler',
            'filename': '/var/log/medirecord/django.log',
            'maxBytes': 50*1024*1024,  # 50MB
            'backupCount': 5,
        },
    },
    'loggers': {
        'django': {
            'handlers': ['file'],
            'level': 'INFO',
            'propagate': True,
        },
        'medirecord': {
            'handlers': ['file'],
            'level': 'INFO',
            'propagate': False,
        },
    },
}
```

### 3. Gunicorn et Systemd

#### /etc/systemd/system/medirecord.service
```ini
[Unit]
Description=MediRecord Django
After=network.target

[Service]
User=medirecord
Group=www-data
WorkingDirectory=/home/medirecord/medirecord-sis
Environment="PATH=/home/medirecord/medirecord-sis/venv/bin"
ExecStart=/home/medirecord/medirecord-sis/venv/bin/gunicorn \
          --workers 3 \
          --bind unix:/home/medirecord/medirecord-sis/medirecord.sock \
          --access-logfile /var/log/medirecord/access.log \
          --error-logfile /var/log/medirecord/error.log \
          mediServe.wsgi:application
Restart=always

[Install]
WantedBy=multi-user.target
```

#### /etc/systemd/system/medirecord-celery.service
```ini
[Unit]
Description=MediRecord Celery Worker
After=network.target

[Service]
User=medirecord
Group=www-data
WorkingDirectory=/home/medirecord/medirecord-sis
Environment="PATH=/home/medirecord/medirecord-sis/venv/bin"
ExecStart=/home/medirecord/medirecord-sis/venv/bin/celery \
          -A mediServe worker \
          --loglevel=info \
          --logfile=/var/log/medirecord/celery.log
Restart=always

[Install]
WantedBy=multi-user.target
```

### 4. Configuration Nginx

#### /etc/nginx/sites-available/medirecord
```nginx
server {
    listen 80;
    server_name votre-domaine.com www.votre-domaine.com;
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name votre-domaine.com www.votre-domaine.com;

    ssl_certificate /etc/letsencrypt/live/votre-domaine.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/votre-domaine.com/privkey.pem;

    client_max_body_size 100M;

    location = /favicon.ico { access_log off; log_not_found off; }
    
    location /static/ {
        root /home/medirecord/medirecord-sis;
        expires 30d;
        add_header Cache-Control "public, immutable";
    }

    location /media/ {
        root /home/medirecord/medirecord-sis;
        expires 7d;
        add_header Cache-Control "public";
    }

    location / {
        include proxy_params;
        proxy_pass http://unix:/home/medirecord/medirecord-sis/medirecord.sock;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # S√©curit√©
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;
    add_header Referrer-Policy "no-referrer-when-downgrade" always;
    add_header Content-Security-Policy "default-src 'self' http: https: data: blob: 'unsafe-inline'" always;
}
```

### 5. D√©ploiement N8N Production

#### docker-compose.yml
```yaml
version: '3.8'

services:
  n8n:
    image: docker.n8n.io/n8nio/n8n
    restart: always
    ports:
      - "5678:5678"
    environment:
      - N8N_HOST=n8n.votre-domaine.com
      - N8N_PORT=5678
      - N8N_PROTOCOL=https
      - NODE_ENV=production
      - WEBHOOK_URL=https://n8n.votre-domaine.com/
      - GENERIC_TIMEZONE=UTC
      - N8N_LOG_LEVEL=info
    volumes:
      - n8n_data:/home/node/.n8n
      - /var/run/docker.sock:/var/run/docker.sock

volumes:
  n8n_data:
```

### 6. Certificats SSL

```bash
# Certificats Let's Encrypt
sudo certbot --nginx -d votre-domaine.com -d www.votre-domaine.com
sudo certbot --nginx -d n8n.votre-domaine.com

# Renouvellement automatique
sudo crontab -e
# Ajouter: 0 12 * * * /usr/bin/certbot renew --quiet
```

### 7. Monitoring et Backups

#### Script de Backup
```bash
#!/bin/bash
# /home/medirecord/scripts/backup.sh

DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_DIR="/backup/medirecord"

# Backup base de donn√©es
pg_dump -h localhost -U medirecord_user medirecord_prod > "$BACKUP_DIR/db_$DATE.sql"

# Backup fichiers
tar -czf "$BACKUP_DIR/media_$DATE.tar.gz" /home/medirecord/medirecord-sis/media/

# Backup N8N
docker exec -t n8n_container n8n export:workflow --backup --output=/home/node/.n8n/backups/workflows_$DATE.json

# Nettoyage (garder 30 jours)
find $BACKUP_DIR -type f -mtime +30 -delete

echo "Backup completed: $DATE"
```

#### Crontab pour Backup Quotidien
```bash
0 2 * * * /home/medirecord/scripts/backup.sh >> /var/log/medirecord/backup.log 2>&1
```

---

## üìä Maintenance et Monitoring

### 1. Logs √† Surveiller

```bash
# Logs Django
tail -f /var/log/medirecord/django.log

# Logs Celery
tail -f /var/log/medirecord/celery.log

# Logs Nginx
tail -f /var/log/nginx/access.log
tail -f /var/log/nginx/error.log

# Logs PostgreSQL
sudo tail -f /var/log/postgresql/postgresql-14-main.log
```

### 2. Commandes de Maintenance

#### Nettoyage Base de Donn√©es
```bash
# Supprimer anciennes m√©triques
python manage.py shell -c "
from metrics.models import SystemMetric
from datetime import datetime, timedelta
cutoff = datetime.now() - timedelta(days=30)
SystemMetric.objects.filter(timestamp__lt=cutoff).delete()
"

# Nettoyer sessions expir√©es
python manage.py shell -c "
from sessions.models import WhatsAppSession
from datetime import datetime, timedelta
cutoff = datetime.now() - timedelta(hours=24)
WhatsAppSession.objects.filter(last_activity__lt=cutoff).update(status='expired')
"
```

#### Optimisation Base de Donn√©es
```bash
# Vacuum PostgreSQL
sudo -u postgres psql medirecord_prod -c "VACUUM ANALYZE;"

# Reindex
sudo -u postgres psql medirecord_prod -c "REINDEX DATABASE medirecord_prod;"
```

### 3. Monitoring Automatique

#### Script de Health Check
```bash
#!/bin/bash
# /home/medirecord/scripts/health_check.sh

# V√©rifier services
systemctl is-active --quiet medirecord || echo "ALERTE: Django service down"
systemctl is-active --quiet medirecord-celery || echo "ALERTE: Celery service down"
systemctl is-active --quiet nginx || echo "ALERTE: Nginx service down"
systemctl is-active --quiet postgresql || echo "ALERTE: PostgreSQL service down"
systemctl is-active --quiet redis || echo "ALERTE: Redis service down"

# V√©rifier API
curl -f -s http://localhost:8000/api/health/ || echo "ALERTE: Health check API failed"

# V√©rifier espace disque
df -h / | awk 'NR==2 {if($5+0 > 85) print "ALERTE: Disk usage " $5}'

# V√©rifier m√©moire
free | awk 'NR==2{printf "Memory: %.0f%%\n", $3/$2*100}' | awk '{if($2+0 > 90) print "ALERTE: " $0}'
```

### 4. Alertes Email

#### Configuration Email Django
```python
# settings_production.py
EMAIL_BACKEND = 'django.core.mail.backends.smtp.EmailBackend'
EMAIL_HOST = 'smtp.gmail.com'
EMAIL_PORT = 587
EMAIL_USE_TLS = True
EMAIL_HOST_USER = os.getenv('EMAIL_USER')
EMAIL_HOST_PASSWORD = os.getenv('EMAIL_PASSWORD')
DEFAULT_FROM_EMAIL = 'noreply@votre-domaine.com'

ADMINS = [
    ('Admin', 'admin@votre-domaine.com'),
]
```

---

## üîß D√©pannage

### Probl√®mes Courants

#### 1. Erreur de Connexion Pinecone
```python
# V√©rifier la configuration
python manage.py shell
>>> from rag.services import PineconeService
>>> service = PineconeService()
>>> print(service.index.describe_index_stats())
```

#### 2. Messages WhatsApp Non Re√ßus
```bash
# V√©rifier logs Twilio
curl -X GET "https://api.twilio.com/2010-04-01/Accounts/$TWILIO_ACCOUNT_SID/Messages.json" \
     -u "$TWILIO_ACCOUNT_SID:$TWILIO_AUTH_TOKEN"

# V√©rifier webhook N8N
curl -X POST https://votre-n8n.com/webhook/test \
     -H "Content-Type: application/json" \
     -d '{"test": "data"}'
```

#### 3. Workflows N8N Inactifs
1. V√©rifier que les workflows sont activ√©s
2. Contr√¥ler les credentials Twilio
3. V√©rifier les URLs de webhook
4. Consulter les logs d'ex√©cution

#### 4. Performance Lente
```bash
# V√©rifier utilisation CPU/M√©moire
htop

# V√©rifier connexions base de donn√©es
sudo -u postgres psql -c "SELECT count(*) FROM pg_stat_activity;"

# V√©rifier Redis
redis-cli info stats
```

### Codes d'Erreur API

| Code | Signification | Solution |
|------|---------------|----------|
| 400 | Donn√©es invalides | V√©rifier le format des donn√©es envoy√©es |
| 401 | Non autoris√© | V√©rifier les tokens d'authentification |
| 404 | Patient non trouv√© | V√©rifier que le patient existe et est actif |
| 500 | Erreur serveur | Consulter les logs Django |
| 503 | Service indisponible | V√©rifier les services externes (Pinecone, Gemini) |

---

## ü§ù Contribuer

### Structure du Code

```
mediServe/
‚îú‚îÄ‚îÄ patients/          # Module patients
‚îÇ   ‚îú‚îÄ‚îÄ models.py      # Mod√®les de donn√©es
‚îÇ   ‚îú‚îÄ‚îÄ views.py       # Vues API
‚îÇ   ‚îú‚îÄ‚îÄ serializers.py # S√©rialiseurs DRF
‚îÇ   ‚îú‚îÄ‚îÄ tasks.py       # T√¢ches Celery
‚îÇ   ‚îî‚îÄ‚îÄ n8n_manager.py # Interface N8N
‚îú‚îÄ‚îÄ rag/              # Module RAG
‚îÇ   ‚îú‚îÄ‚îÄ models.py     # Mod√®les documents/conversations
‚îÇ   ‚îú‚îÄ‚îÄ services.py   # Services IA (Gemini, Pinecone)
‚îÇ   ‚îî‚îÄ‚îÄ views.py      # API RAG
‚îú‚îÄ‚îÄ messaging/        # Module messages diffus√©s
‚îÇ   ‚îú‚îÄ‚îÄ models.py     # Mod√®les broadcast
‚îÇ   ‚îú‚îÄ‚îÄ views.py      # API messaging
‚îÇ   ‚îú‚îÄ‚îÄ tasks.py      # Envoi asynchrone
‚îÇ   ‚îî‚îÄ‚îÄ services.py   # Service WhatsApp
‚îî‚îÄ‚îÄ tests/           # Tests automatis√©s
```

### Standards de Code

- **Python** : PEP 8 + Black formatter
- **JavaScript** : ESLint + Prettier
- **Tests** : Pytest pour Python, Jest pour Frontend
- **Documentation** : Docstrings pour toutes les fonctions publiques

### Process de Contribution

1. Fork le repository
2. Cr√©er une branche feature (`git checkout -b feature/nouvelle-fonctionnalite`)
3. Commiter les changements (`git commit -am 'Ajouter nouvelle fonctionnalit√©'`)
4. Pousser vers la branche (`git push origin feature/nouvelle-fonctionnalite`)
5. Cr√©er une Pull Request

### Tests Requis

```bash
# Tests unitaires
make test

# Tests de couverture
make test-coverage

# Tests d'int√©gration
make test-integration

# V√©rification du code
make lint
```

---

## üìû Support

- **Documentation** : Cette documentation
- **Issues** : GitHub Issues pour les bugs
- **Email** : support@votre-domaine.com
- **Discord** : Serveur communaut√© (optionnel)

---

## üìÑ Licence

Ce projet est sous licence MIT. Voir le fichier `LICENSE` pour plus de d√©tails.

---

## üîÑ Changelog

### v1.0.0 (2024-12-01)
- Impl√©mentation initiale du syst√®me RAG
- Interface patient WhatsApp
- Messages diffus√©s
- Dashboard m√©decin
- Monitoring et m√©triques

### v1.1.0 (Planifi√©)
- Support vocal en Wolof
- Interface mobile native
- Analytics avanc√©s
- Int√©gration FHIR

---

## üôè Remerciements

- √âquipe de d√©veloppement
- Professionnels de sant√© testeurs
- Communaut√© open source
- Google (Gemini API)
- Pinecone
- Twilio
- N8N Community